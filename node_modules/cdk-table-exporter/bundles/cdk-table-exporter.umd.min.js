!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/cdk/table"),require("file-saver"),require("xlsx"),require("@angular/core")):"function"==typeof define&&define.amd?define("cdk-table-exporter",["exports","@angular/cdk/table","file-saver","xlsx","@angular/core"],e):e(t["cdk-table-exporter"]={},t.ng.cdk.table,t.FileSaver,t.XLSX,t.ng.core)}(this,function(t,e,i,n,a){"use strict";var r=function(){function t(){}return t.decorators=[{type:a.NgModule,args:[{declarations:[],imports:[e.CdkTableModule],exports:[]}]}],t}(),o={XLS:"xls",XLSX:"xlsx",CSV:"csv",TXT:"txt",JSON:"json",OTHER:"other"},c=function J(t,e){this.extension=t,this.contentTypeHeader=e},s="mat-table-exporter",u="array",p=";charset=utf-",l=p+"8",f=o.TXT+"/",h="application/",d=h+"octet-stream",y=".",x=y+o.XLS,g=y+o.XLSX,T=y+o.CSV,_=y+o.JSON,b=y+o.TXT,E=new c(x,d+l),v=new c(g,d+l),m=new c(_,f+JSON+l),I=new c(b,f+o.TXT+l),S=new c(T,f+o.CSV+l),w=".*."+o.XLS+"$",O="!cols",C=function(){function e(){}return e.save=function(t,e,r){var n=new Blob([t],{type:e.contentTypeHeader}),o=s;r&&r.fileName&&(o=r.fileName),i.saveAs(n,o+e.extension)},e.isXls=function(t){return null!=t.toLowerCase().match(w)},e.identifyExportType=function(t){return t&&e.isXls(t)?o.XLS:o.XLSX},e.removeExtension=function(t){t.fileName=t.fileName.split(y)[0]},e}(),N=function(){function t(t,e,r,n,o){this.renderer=t,this.serviceLocator=e,this.dataExtractor=r,this.table=n,this.viewContainerRef=o,this.exportCompleted=new a.EventEmitter,this.exportStarted=new a.EventEmitter,this.initCdkTable()}return Object.defineProperty(t.prototype,"cdkTable",{get:function(){return this._cdkTable},set:function(t){console.warn("cdkTable input is deprecated!"),this._cdkTable=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"exporterButton",{get:function(){return this._exporterButton},set:function(t){console.warn("exporterButton input is deprecated!"),this._exporterButton=t,this.setButtonListener()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fileName",{get:function(){return this._fileName},set:function(t){console.warn("fileName input is deprecated!"),this._fileName=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sheetName",{get:function(){return this._sheetName},set:function(t){console.warn("sheetName input is deprecated!"),this._sheetName=t},enumerable:!0,configurable:!0}),t.prototype.initCdkTable=function(){var t=this.viewContainerRef._data.componentView.component;if(t)this._cdkTable=t;else{if(!this.table)throw new Error("Unsupported Angular version");this._cdkTable=this.table}},t.prototype.setButtonListener=function(){var r=this;this._exporterButton&&this.renderer.listen(this._exporterButton._elementRef.nativeElement,"click",function(t){var e={fileName:r._fileName,sheet:r._sheetName};r.exportTable(C.identifyExportType(r._fileName),e)})},t.prototype.exportTable=function(t,e){this.loadExporter(t),this._options=e,this.exportStarted.emit(),this._isIterating=!0,this._isExporting=!0,this._data=new Array,this.enableExportButton(!1),this.extractTableHeader();try{this.exportWithPagination()}catch(r){this.exportSinglePage()}},t.prototype.loadExporter=function(t){t===o.OTHER.valueOf()?this._exporterService=this.exporter:this._exporterService=this.serviceLocator.getService(t)},t.prototype.exportWithPagination=function(){this._initialPageIndex=this.getCurrentPageIndex(),this.initPageHandler(),this.goToPage(0)},t.prototype.exportSinglePage=function(){this.extractDataOnCurrentPage(),this.extractTableFooter(),this.exportExtractedData()},t.prototype.extractDataOnCurrentPage=function(){this._data=this._data.concat(this.dataExtractor.extractRows(this._cdkTable,this.hiddenColumns))},t.prototype.initPageHandler=function(){var t=this;this._subscription||(this._subscription=this.getPageChangeObservable().subscribe(function(){setTimeout(function(){t._isIterating?(t.extractDataOnCurrentPage(),t.hasNextPage()?t.nextPage():(t._isIterating=!1,t.goToPage(t._initialPageIndex))):t._isExporting&&(t._isExporting=!1,t.extractTableFooter(),t.exportExtractedData())})}))},t.prototype.exportExtractedData=function(){this._exporterService["export"](this._data,this._options),this._data=new Array,this.enableExportButton(!0),this.exportCompleted.emit()},t.prototype.extractSpecialRow=function(t){var e=this.dataExtractor.extractRow(this._cdkTable,this.hiddenColumns,t);e&&this._data.push(e)},t.prototype.extractTableHeader=function(){this.extractSpecialRow(this._cdkTable._headerRowOutlet)},t.prototype.extractTableFooter=function(){this.extractSpecialRow(this._cdkTable._footerRowOutlet)},t.prototype.hasNextPage=function(){return this.getCurrentPageIndex()<this.getPageCount()-1},t.prototype.nextPage=function(){this.goToPage(this.getCurrentPageIndex()+1)},t.prototype.enableExportButton=function(t){this._exporterButton&&this.renderer.setProperty(this._exporterButton._elementRef.nativeElement,"disabled",t?null:"true")},t.propDecorators={hiddenColumns:[{type:a.Input}],exporter:[{type:a.Input}],exportCompleted:[{type:a.Output}],exportStarted:[{type:a.Output}],cdkTable:[{type:a.Input}],exporterButton:[{type:a.Input}],fileName:[{type:a.Input}],sheetName:[{type:a.Input}]},t}(),X=function(){function t(){}return t.prototype["export"]=function(t,e){if(!t)throw new Error("Empty json array is provided, rows parameter is mandatory!");var r=this.createContent(t,e),n=this.getMimeType();C.save(r,n,e)},t}(),P=function(t,e){return(P=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function j(t,e){function r(){this.constructor=t}P(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var R=function(t){function e(){return t.call(this)||this}return j(e,t),e.prototype.createContent=function(t,e){return JSON.stringify(t)},e.prototype.getMimeType=function(){return m},e.decorators=[{type:a.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[]},e.ngInjectableDef=a.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(X),k=function(t){function e(){return t.call(this)||this}return j(e,t),e.prototype.createContent=function(t,e){var r=this,n="";return t.forEach(function(t){n+=Object.values(t).join(r.getDelimiter(e))+"\n"}),n},e.prototype.getMimeType=function(){return I},e.prototype.getDelimiter=function(t){return t&&t.delimiter?t.delimiter:"\t"},e.decorators=[{type:a.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[]},e.ngInjectableDef=a.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(X),L=function(t){function e(){return t.call(this)||this}return j(e,t),e.prototype.createContent=function(t,e){var r=n.utils.json_to_sheet(t,{skipHeader:!0});return this.workSheetToContent(r,e)},e}(X),A=function(t){function e(){return t.call(this)||this}return j(e,t),e.prototype.workSheetToContent=function(t,e){void 0===e&&(e={});var r=n.utils.book_new();return e.columnWidths&&(t[O]=this.convertToWch(e.columnWidths)),this.correctTypes(e),n.utils.book_append_sheet(r,t,e.sheet),n.write(r,e)},e.prototype.getMimeType=function(){return E},e.prototype.correctTypes=function(t){t.type||(t.type=u),t.bookType=this.getMimeType().extension.replace(".","")},e.prototype.convertToWch=function(t){return t.map(function(t){return{wch:t}})},e.decorators=[{type:a.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[]},e.ngInjectableDef=a.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(L),M=function(t){function e(){return t.call(this)||this}return j(e,t),e.prototype.getMimeType=function(){return v},e.decorators=[{type:a.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[]},e.ngInjectableDef=a.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(A),D=function(t){function e(){return t.call(this)||this}return j(e,t),e.prototype.workSheetToContent=function(t,e){return n.utils.sheet_to_csv(t)},e.prototype.getMimeType=function(){return S},e.decorators=[{type:a.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[]},e.ngInjectableDef=a.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(L),B=function(){function t(t){this.injector=t}return t.prototype.getService=function(t){switch(t){case o.XLS.valueOf():return this.injector.get(A);case o.XLSX.valueOf():return this.injector.get(M);case o.JSON.valueOf():return this.injector.get(R);case o.TXT.valueOf():return this.injector.get(k);case o.CSV.valueOf():return this.injector.get(D);case o.OTHER.valueOf():return null;default:return this.injector.get(M)}},t.decorators=[{type:a.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:a.Injector}]},t.ngInjectableDef=a.defineInjectable({factory:function(){return new t(a.inject(a.INJECTOR))},token:t,providedIn:"root"}),t}(),H=function(){function t(){}return t.prototype.extractRows=function(t,e){return this.getRowsAsJsonArray(t,e,t._rowOutlet)},t.prototype.extractRow=function(t,e,r){return this.getRowsAsJsonArray(t,e,r)[0]},t.prototype.getRowsAsJsonArray=function(t,e,r){var n=this.getRenderedRows(t,r);return this.convertToJsonArray(e,n)},t.prototype.getRenderedRows=function(t,e){return t._getRenderedRows(e)},t.prototype.convertToJsonArray=function(t,e){for(var r=new Array,n=0;n<e.length;n++){var o=this.convertRow(t,e[n]);r.push(this.createExcelItem(o))}return r},t.prototype.convertRow=function(t,e){for(var r=new Array,n=e.children,o=0;o<n.length;o++)if(!this.shouldHide(t,o)){var i=n.item(o).innerText;r.push(i)}return r},t.prototype.shouldHide=function(t,e){return!(!t||!t.includes(e))},t.prototype.createExcelItem=function(t){return Object.assign({},t)},t.decorators=[{type:a.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[]},t.ngInjectableDef=a.defineInjectable({factory:function(){return new t},token:t,providedIn:"root"}),t}();t.CdkTableExporter=N,t.FileExporter=X,t.JsonExporterService=R,t.TxtExporterService=k,t.XlsExporterService=A,t.WorksheetExporter=L,t.XlsxExporterService=M,t.CsvExporterService=D,t.ExportType=o,t.ServiceLocatorService=B,t.DataExtractorService=H,t.Mime=c,t.FileUtil=C,t.CdkTableExporterModule=r,t.MAT_TABLE_EXPORTER=s,t.TYPE_ARRAY=u,t.CHAR_SET_UTF=p,t.CHAR_SET_UTF_8=l,t.CONTENT_TYPE_TEXT=f,t.CONTENT_TYPE_APPLICATION=h,t.CONTENT_TYPE_EXCEL=d,t.DOT=y,t.EXTENSION_XLS=x,t.EXTENSION_XLSX=g,t.EXTENSION_CSV=T,t.EXTENSION_JSON=_,t.EXTENSION_TEXT=b,t.MIME_EXCEL_XLS=E,t.MIME_EXCEL_XLSX=v,t.MIME_JSON=m,t.MIME_TXT=I,t.MIME_CSV=S,t.REF="!ref",t.XLS_REGEX=w,t.RETURN="\n",t.TAB="\t",t.XLSX_COLS=O,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=cdk-table-exporter.umd.min.js.map