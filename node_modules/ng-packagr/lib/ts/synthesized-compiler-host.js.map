{"version":3,"file":"synthesized-compiler-host.js","sourceRoot":"","sources":["../../../src/lib/ts/synthesized-compiler-host.ts"],"names":[],"mappings":";;AAAA,iCAAiC;AACjC,uEAAqF;AAErF;;;;;;;GAOG;AACH,qDACE,WAA4B,EAC5B,eAAmC;IAEnC,sEAAsE;IACtE,MAAM,OAAO,GAAG,EAAE,CAAC,kBAAkB,CAAC,eAAe,EAAE,oBAAoB,CAAC,IAAI,CAAC,CAAC;IAElF,MAAM,mBACD,OAAO,IACV,aAAa,EAAE,CAAC,QAAQ,EAAE,OAAO,EAAE,EAAE;YACnC,IAAI,UAAU,GAAG,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,QAAQ,KAAK,QAAQ,CAAC,CAAC;YAEtE,EAAE,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC;gBACf,uEAAuE;gBACvE,4EAA4E;gBAC5E,EAAE,CAAC,CAAC,UAAU,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC;oBAC/B,UAAU,GAAG,UAAU,CAAC,cAAc,CAAC,CAAC,cAAc,CAAC;gBACzD,CAAC;gBAED,4DAA4D;gBAC5D,uFAAuF;gBACvF,EAAE,CAAC,CAAC,CAAC,UAAU,CAAC,oBAAoB,CAAC,IAAI,UAAU,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;oBAChE,UAAU,CAAC,oBAAoB,CAAC,GAAG,UAAU,CAAC,UAAU,CAAC,CAAC,oBAAoB,CAAC,CAAC;gBAClF,CAAC;gBAED,qFAAqF;gBACrF,6FAA6F;gBAC7F,MAAM,gBAAgB,GAAG,CAAC,UAAU,CAAC,KAAK,GAAG,CAAC,CAAC,KAAK,CAAC,CAAC;gBACtD,EAAE,CAAC,CAAC,gBAAgB,IAAI,iDAAuB,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;oBAC5D,MAAM,CAAC,yCAAe,CAAC,UAAU,CAAC,CAAC;gBACrC,CAAC;gBAED,MAAM,CAAC,UAAU,CAAC;YACpB,CAAC;YAAC,IAAI,CAAC,CAAC;gBACN,MAAM,CAAC,OAAO,CAAC,aAAa,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAC;YAClD,CAAC;QACH,CAAC,EACD,mBAAmB,EAAE,CAAC,QAAQ,EAAE,IAAI,EAAE,eAAe,EAAE,EAAE;YACvD,MAAM,IAAI,KAAK,CAAC,kBAAkB,CAAC,CAAC;YAEpC,uCAAuC;YACvC,uEAAuE;QACzE,CAAC,IACD;AACJ,CAAC;AA5CD,kGA4CC","sourcesContent":["import * as ts from 'typescript';\nimport { isSynthesizedSourceFile, writeSourceFile } from './synthesized-source-file';\n\n/**\n * Creates a TypeScript {@link CompilerHost} that reads source files from a collection. Should\n * a source file include synthesized source text replacements, i.e., the source file is a\n * {@link SynthesizedSourceFile}, it will apply source text replacements.\n *\n * @param sourceFiles A collection of TypeScript source files\n * @param compilerOptions Compiler options\n */\nexport function createCompilerHostForSynthesizedSourceFiles(\n  sourceFiles: ts.SourceFile[],\n  compilerOptions: ts.CompilerOptions\n): ts.CompilerHost {\n  // FIX(#625): pass `setParentNodes` to the \"synthesized\" compiler host\n  const wrapped = ts.createCompilerHost(compilerOptions, /* setParentNodes */ true);\n\n  return {\n    ...wrapped,\n    getSourceFile: (fileName, version) => {\n      let sourceFile = sourceFiles.find(file => file.fileName === fileName);\n\n      if (sourceFile) {\n        // FIX(#473): typescript has internal notion of \"redirect source files\"\n        // Do not return the redirected file, but rather the target of the redirect.\n        if (sourceFile['redirectInfo']) {\n          sourceFile = sourceFile['redirectInfo'].redirectTarget;\n        }\n\n        // FIX: https://github.com/Microsoft/TypeScript/issues/19950\n        // After typescript transformation, `ambientModuleNames` may become undefined. Copy it.\n        if (!sourceFile['ambientModuleNames'] && sourceFile['original']) {\n          sourceFile['ambientModuleNames'] = sourceFile['original']['ambientModuleNames'];\n        }\n\n        // FIX: `ts.SourceFile` with the synthetic flag cause one of ngc/tsc/tsickle to choke\n        // Workaround the issue by creating a fresh source file and copying/replacing the source text\n        const hasSyntheticFlag = (sourceFile.flags & 8) !== 0;\n        if (hasSyntheticFlag || isSynthesizedSourceFile(sourceFile)) {\n          return writeSourceFile(sourceFile);\n        }\n\n        return sourceFile;\n      } else {\n        return wrapped.getSourceFile(fileName, version);\n      }\n    },\n    getSourceFileByPath: (fileName, path, languageVersion) => {\n      throw new Error(`Not implemented.`);\n\n      // console.warn('getSourceFileByPath');\n      // return wrapped.getSourceFileByPath(fileName, path, languageVersion);\n    }\n  };\n}\n"]}